---
import Layout from "./Layout.astro";
---

<Layout>
  <header
    class="w-full bg-gray-900 border-b border-gray-700 shadow-md py-4 px-6 flex items-center justify-between"
  >
    <h1 class="text-xl font-bold text-white">Problematic 2k25</h1>

    <p id="timer" class="text-xl font-semibold text-red-400">30:00</p>

    <div id="player-info" class="flex items-center gap-6 text-gray-200 text-sm">
      <p id="name"></p>
      <p id="branch"></p>
      <p id="year"></p>
    </div>
  </header>

  <div class="p-6">
    <slot />
  </div>
</Layout>

<script>
  import { getPlayer } from "@/store/player.store";

  document.addEventListener("DOMContentLoaded", () => {
    // Player data
    const player = getPlayer();
    if (!player) {
      window.location.href = "/login";
      return;
    }

    const { name, branch, year } = player;

    const nameEl = document.getElementById("name");
    const branchEl = document.getElementById("branch");
    const yearEl = document.getElementById("year");

    if (nameEl) nameEl.textContent = name;
    if (branchEl) branchEl.textContent = branch;
    if (yearEl) yearEl.textContent = `Year ${year}`;

    // timer
    let timeRemaining = 30 * 60; // 30 minutes 
    const timerEl = document.getElementById("timer");

    if (!timerEl) {
      return;
    }

    const updateTimer = () => {
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      timerEl.textContent = `${minutes.toString().padStart(2, "0")}:${seconds
        .toString()
        .padStart(2, "0")}`;
    };

    updateTimer();

    const timerInterval = setInterval(() => {
      if (timeRemaining > 0) {
        timeRemaining--;
        updateTimer();
      } else {
        clearInterval(timerInterval);
        timerEl.textContent = "Timeâ€™s up!";
        timerEl.classList.replace("text-red-400", "text-yellow-400");
      }
    }, 1000);
  });
</script>
